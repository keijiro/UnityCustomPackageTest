# Agent 向けワークフロー指示

## プロジェクト構成

Packages ディレクトリ内にこのプロジェクトで開発している主たる UPM パッケージが存在する。名前は "jp.keijiro.[package-name]" という形をとる。

リポジトリのルートディレクトリに README.md, CHANGELOG.md, LICENSE が存在する。パッケージ内にも同名ファイルが存在しており、ルートディレクトリ側を更新した場合は、パッケージ内のそれらと同期する必要がある。

## アクション定義：「Changelog の更新」

「Changelog の更新」とは、CHANGELOG.md の [Unreleased] セクションを現状に合わせて更新することを意味する。直前のバージョンから現在までの git commit を確認することで変更内容を把握し、適切な内容を [Unreleased] セクションに追記する。

なお、[Unreleased] セクションには既に手動で記入された文章が存在することもある。それをプルーフリードした上で、追加した内容と適合するように調整する。また、[Unreleased] セクションが存在しない場合は追加する。

## アクション定義：「パッケージのリリース準備」

「パッケージのリリース準備」とは、Packages ディレクトリ内に存在する UPM パッケージの情報を更新し、新しいバージョンをリリースするための準備を行うことを意味する。

具体的には次のような作業を行う：

- package.json の version をインクリメントする。
- package.json の "_upm" エレメントを更新する。その内容については後述する。
- CHANGELOG.md 内の [Unreleased] セクション見出しを、新しいバージョン番号と今日の日付で更新する。
- それらの変更を git commit し、git tag で新しいバージョン番号を付与する。

## package.json の "_upm" エレメントについて

package.json の "_upm" エレメントには "changelog" というエントリのみ存在する。その内容は CHANGELOG.md の最新バージョンの内容をコピーしたものであるが、Unity の Rich Text フォーマットで記述する必要がある。具体的には、見出しを <b> で太字化し、改行は <br> で行う。２つ目以降の見出しの前には改行を一つ追加で挿入すること。

## アクション定義：「パッケージのリリース」

「パッケージのリリース」とは、Unity からエクスポートされた tarball を新バージョンとしてリリースすることを意味する。

具体的には次のような作業を行う：

- リポジトリのルートディレクトリに "[package-name]-[version].tgz" という形で tarball が存在することを確認する。これは Unity Editor から手動でエクスポート作業を行う必要があるので、このファイルが見つからない場合はユーザーに作業を求めること。
- gh コマンドを使って GitHub 上にリリースを作成する。
  - このリリースのリリースノートは CHANGELOG.md の最新バージョンの内容をコピーしたものを使う。
  - このリリースのタイトルは内容を端的にまとめたうえで "[version]: [title]" のという形にする。
    - まとめ方は非常に端的なものでよく、例えばバグ修正が中心であれば "Bug fixes" のようなもので構わない。
    - タイトルを決めたら、ユーザーに一度確認を求めること。
- npm コマンドを使って tarball を publish する。

